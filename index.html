<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storm v2.0 - Empathetic AI Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 900px;
            height: 90vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .status-indicators {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            font-size: 12px;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-dot.active {
            background: #4ade80;
            box-shadow: 0 0 10px #4ade80;
        }

        .status-dot.processing {
            background: #fbbf24;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-content {
            flex: 1;
            display: flex;
            gap: 20px;
            padding: 20px;
            overflow: hidden;
        }

        .chat-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f9fafb;
            border-radius: 15px;
            border: 2px solid #e5e7eb;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .emotional-meter {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
        }

        .emotion-bar {
            width: 60px;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        .emotion-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ade80, #fbbf24, #f87171);
            width: 0%;
            transition: width 0.3s ease;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .messages::-webkit-scrollbar {
            width: 8px;
        }

        .messages::-webkit-scrollbar-track {
            background: #e5e7eb;
            border-radius: 10px;
        }

        .messages::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .message {
            display: flex;
            gap: 12px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 18px;
            flex-shrink: 0;
        }

        .message.ai .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 15px;
            word-wrap: break-word;
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .message.ai .message-bubble {
            background: #e5e7eb;
            color: #1f2937;
            border: 2px solid #d1d5db;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .message-time {
            font-size: 11px;
            color: #9ca3af;
            margin-top: 4px;
        }

        .input-section {
            padding: 20px;
            background: white;
            border-top: 2px solid #e5e7eb;
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .input-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        #messageInput {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 14px;
            resize: none;
            max-height: 100px;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        #messageInput:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-tools {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .tool-btn {
            padding: 6px 12px;
            background: #f3f4f6;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            color: #6b7280;
            font-weight: 500;
        }

        .tool-btn:hover {
            background: #e5e7eb;
            border-color: #667eea;
            color: #667eea;
        }

        .tool-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        #sendBtn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s ease;
            white-space: nowrap;
        }

        #sendBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        #sendBtn:active {
            transform: translateY(0);
        }

        .sidebar {
            width: 280px;
            background: white;
            border-radius: 15px;
            border: 2px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .sidebar-content::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar-content::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 3px;
        }

        .memory-section, .analytics-section, .safety-section {
            background: #f9fafb;
            padding: 12px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .section-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .memory-item, .stat-item, .safety-alert {
            background: white;
            padding: 8px 10px;
            border-radius: 8px;
            font-size: 12px;
            color: #4b5563;
            margin-bottom: 6px;
            border-left: 3px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .memory-item:last-child, .stat-item:last-child, .safety-alert:last-child {
            margin-bottom: 0;
        }

        .clear-btn {
            padding: 8px 12px;
            background: #fee2e2;
            color: #dc2626;
            border: 2px solid #fecaca;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s ease;
            width: 100%;
            margin-top: 10px;
        }

        .clear-btn:hover {
            background: #fecaca;
        }

        .safety-alert {
            border-left-color: #f87171;
            background: #fef2f2;
            color: #991b1b;
        }

        .safety-alert.warning {
            border-left-color: #fbbf24;
            background: #fef3c7;
            color: #92400e;
        }

        .safety-alert.info {
            border-left-color: #60a5fa;
            background: #eff6ff;
            color: #1e40af;
        }

        .stat-value {
            font-weight: 600;
            color: #667eea;
        }

        .math-keyboard {
            display: none;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 12px;
            background: #f3f4f6;
            border-radius: 10px;
        }

        .math-keyboard.active {
            display: grid;
        }

        .math-key {
            padding: 8px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.2s ease;
            color: #4b5563;
        }

        .math-key:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .timestamp {
            font-size: 11px;
            color: #9ca3af;
            text-align: center;
            margin: 10px 0;
            padding: 0 15px;
        }

        .loading-indicator {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }

        .loading-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .loading-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0%, 80%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            40% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .emotion-indicator {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-size: 14px;
            margin-left: 8px;
        }

        .emotion-happy { background: #d4fc79; color: #333; }
        .emotion-neutral { background: #a78bfa; color: white; }
        .emotion-concerned { background: #fbbf24; color: #333; }
        .emotion-distressed { background: #f87171; color: white; }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                max-height: 200px;
            }

            .message-bubble {
                max-width: 85%;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }

            .status-indicators {
                gap: 8px;
            }

            .status-badge {
                padding: 4px 10px;
                font-size: 11px;
            }

            .main-content {
                gap: 10px;
                padding: 10px;
            }

            .message-bubble {
                max-width: 90%;
            }
        }

        .emotion-history {
            display: flex;
            gap: 4px;
            margin-top: 8px;
        }

        .emotion-point {
            width: 4px;
            height: 20px;
            border-radius: 2px;
            background: #e5e7eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° Storm v2.0</h1>
            <p>Empathetic AI Assistant with Advanced Capabilities</p>
            <div class="status-indicators">
                <div class="status-badge">
                    <span class="status-dot active"></span>
                    <span>Emotional Detection</span>
                </div>
                <div class="status-badge">
                    <span class="status-dot active"></span>
                    <span>Mental Health Safe</span>
                </div>
                <div class="status-badge">
                    <span class="status-dot active"></span>
                    <span>Math Support</span>
                </div>
                <div class="status-badge">
                    <span class="status-dot active"></span>
                    <span>Persistent Memory</span>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="chat-section">
                <div class="chat-header">
                    <span>üí¨ Conversation</span>
                    <div class="emotional-meter">
                        <span>Emotion:</span>
                        <div class="emotion-bar">
                            <div class="emotion-fill"></div>
                        </div>
                        <span id="emotionLabel">Neutral</span>
                        <span class="emotion-indicator emotion-neutral">üòê</span>
                    </div>
                </div>

                <div class="messages" id="messagesContainer">
                    <div style="text-align: center; color: #9ca3af; padding: 40px 20px;">
                        <div style="font-size: 48px; margin-bottom: 10px;">üëã</div>
                        <p style="margin-bottom: 10px;"><strong>Welcome to Storm v2.0!</strong></p>
                        <p>I'm here to listen, support, and assist you with:</p>
                        <p style="margin-top: 15px; font-size: 13px;">
                            üí≠ Emotional Support ‚Ä¢ üßÆ Advanced Mathematics<br>
                            üíæ Memory & Learning ‚Ä¢ üõ°Ô∏è Mental Health Safety<br>
                            üìä Analysis & Insights
                        </p>
                    </div>
                </div>

                <div class="input-section">
                    <div class="input-wrapper">
                        <div class="input-tools">
                            <button class="tool-btn" id="mathBtn" title="Enable math keyboard">‚àë Math</button>
                            <button class="tool-btn" id="emotionBtn" title="Show emotion tracking">üòä Emotion</button>
                            <button class="tool-btn" id="safetyBtn" title="Mental health resources">üõ°Ô∏è Safety</button>
                            <button class="tool-btn" id="voiceBtn" title="Voice input">üé§ Voice</button>
                        </div>
                        <div class="math-keyboard" id="mathKeyboard">
                            <button class="math-key">‚àö</button>
                            <button class="math-key">‚à´</button>
                            <button class="math-key">‚àë</button>
                            <button class="math-key">œÄ</button>
                            <button class="math-key">‚àû</button>
                            <button class="math-key">‚â§</button>
                            <button class="math-key">‚â•</button>
                            <button class="math-key">‚â†</button>
                            <button class="math-key">¬±</button>
                            <button class="math-key">√∑</button>
                            <button class="math-key">√ó</button>
                            <button class="math-key">¬≤</button>
                        </div>
                        <textarea id="messageInput" placeholder="Share your thoughts, ask questions, or describe how you're feeling..." rows="2"></textarea>
                    </div>
                    <button id="sendBtn">Send</button>
                </div>
            </div>

            <div class="sidebar">
                <div class="sidebar-header">
                    üìä Analytics & Memory
                    <button class="clear-btn" id="clearMemoryBtn" style="width: auto; margin: 0; padding: 4px 8px; font-size: 10px;">üóëÔ∏è</button>
                </div>
                <div class="sidebar-content">
                    <div class="memory-section">
                        <div class="section-title">üíæ User Profile</div>
                        <div class="memory-item">
                            <span>Name</span>
                            <span id="memoryName">Not set</span>
                        </div>
                        <div class="memory-item">
                            <span>Mood Status</span>
                            <span id="memoryMood">Unknown</span>
                        </div>
                        <div class="memory-item">
                            <span>Conversations</span>
                            <span id="memoryCounts" class="stat-value">0</span>
                        </div>
                    </div>

                    <div class="analytics-section">
                        <div class="section-title">üìà Session Stats</div>
                        <div class="stat-item">
                            <span>Messages Sent</span>
                            <span class="stat-value" id="statMessages">0</span>
                        </div>
                        <div class="stat-item">
                            <span>Avg Sentiment</span>
                            <span class="stat-value" id="statSentiment">Neutral</span>
                        </div>
                        <div class="stat-item">
                            <span>Session Time</span>
                            <span class="stat-value" id="statTime">0m</span>
                        </div>
                        <div class="emotion-history" id="emotionHistory"></div>
                    </div>

                    <div class="safety-section">
                        <div class="section-title">üõ°Ô∏è Safety Status</div>
                        <div class="safety-alert info">
                            ‚úì All conversations are private and secure
                        </div>
                        <div class="safety-alert info">
                            ‚ÑπÔ∏è AI is not a replacement for professional help
                        </div>
                        <div class="safety-alert" id="safetyWarning" style="display: none;">
                            ‚ö†Ô∏è Please reach out to a professional
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Storm v2.0 - Empathetic AI Assistant
        class StormAI {
            constructor() {
                this.messages = [];
                this.userProfile = this.loadUserProfile();
                this.sessionStats = {
                    messageCount: 0,
                    sentiments: [],
                    startTime: Date.now(),
                    emotionHistory: []
                };
                this.conversationContext = [];
                this.mentalhealthKeywords = {
                    distressed: ['depressed', 'suicidal', 'harm', 'hurt myself', 'give up', 'hopeless', 'worthless'],
                    concerned: ['sad', 'anxious', 'stressed', 'worried', 'scared', 'panic'],
                    happy: ['happy', 'joy', 'great', 'wonderful', 'excited', 'love'],
                    neutral: []
                };
                this.mathPatterns = /[\d\s\+\-\*\/\(\)\.\,\‚àö‚à´‚àëœÄ‚àû‚â§‚â•‚â†¬±√∑√ó¬≤¬≥‚Å¥‚àö]/g;
                this.initializeEventListeners();
                this.updateSessionStats();
                this.updateMemoryDisplay();
                this.addSystemMessage('Welcome to Storm v2.0! I\'m an empathetic AI assistant designed to listen, support, and help you with any questions or concerns you may have. How can I assist you today?');
            }

            loadUserProfile() {
                const stored = localStorage.getItem('stormUserProfile');
                return stored ? JSON.parse(stored) : {
                    name: 'User',
                    mood: 'Unknown',
                    conversationCount: 0,
                    preferences: {
                        enableMath: false,
                        enableVoice: false,
                        theme: 'light'
                    }
                };
            }

            saveUserProfile() {
                localStorage.setItem('stormUserProfile', JSON.stringify(this.userProfile));
            }

            initializeEventListeners() {
                document.getElementById('sendBtn').addEventListener('click', () => this.sendMessage());
                document.getElementById('messageInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
                document.getElementById('mathBtn').addEventListener('click', () => this.toggleMathKeyboard());
                document.getElementById('emotionBtn').addEventListener('click', () => this.showEmotionTracking());
                document.getElementById('safetyBtn').addEventListener('click', () => this.showMentalHealthResources());
                document.getElementById('voiceBtn').addEventListener('click', () => this.initializeVoiceInput());
                document.getElementById('clearMemoryBtn').addEventListener('click', () => this.clearMemory());

                // Math keyboard key listeners
                document.querySelectorAll('.math-key').forEach(key => {
                    key.addEventListener('click', (e) => {
                        const input = document.getElementById('messageInput');
                        input.value += e.target.textContent;
                        input.focus();
                    });
                });
            }

            toggleMathKeyboard() {
                const keyboard = document.getElementById('mathKeyboard');
                const btn = document.getElementById('mathBtn');
                keyboard.classList.toggle('active');
                btn.classList.toggle('active');
                this.userProfile.preferences.enableMath = btn.classList.contains('active');
                this.saveUserProfile();
            }

            showMentalHealthResources() {
                const resources = `
üõ°Ô∏è **Mental Health Resources:**

**Crisis Support (24/7):**
‚Ä¢ International Association for Suicide Prevention: https://www.iasp.info/resources/Crisis_Centres/
‚Ä¢ Crisis Text Line: Text HOME to 741741
‚Ä¢ National Suicide Prevention Lifeline: 988 (US)

**Support Services:**
‚Ä¢ MIND UK: https://www.mind.org.uk/
‚Ä¢ NAMI Helpline: 1-800-950-NAMI
‚Ä¢ BetterHelp: Online therapy counseling

**Important Reminders:**
‚úì You are not alone
‚úì Your feelings are valid
‚úì Professional help is available
‚úì Crisis situations require immediate professional support

Would you like to talk about what's on your mind?
                `;
                this.addSystemMessage(resources);
            }

            detectEmotion(text) {
                const lowerText = text.toLowerCase();
                let emotionScore = 0;
                let emotionType = 'neutral';
                let emoji = 'üòê';

                for (const [emotion, keywords] of Object.entries(this.mentalhealthKeywords)) {
                    const matches = keywords.filter(k => lowerText.includes(k)).length;
                    if (matches > 0) {
                        if (emotion === 'distressed') {
                            emotionScore = 3;
                            emotionType = 'distressed';
                            emoji = 'üò¢';
                        } else if (emotion === 'concerned' && emotionScore < 2) {
                            emotionScore = 2;
                            emotionType = 'concerned';
                            emoji = 'üòü';
                        } else if (emotion === 'happy' && emotionScore < 1) {
                            emotionScore = 1;
                            emotionType = 'happy';
                            emoji = 'üòä';
                        }
                    }
                }

                return {
                    score: emotionScore,
                    type: emotionType,
                    emoji: emoji,
                    intensity: emotionScore / 3
                };
            }

            generateResponse(userMessage) {
                const emotion = this.detectEmotion(userMessage);
                this.sessionStats.emotionHistory.push(emotion);
                this.updateEmotionDisplay(emotion);

                const responses = {
                    greeting: [
                        "Hello! It's great to talk with you. How are you feeling today?",
                        "Hi there! I'm here to listen. What's on your mind?",
                        "Hello! Nice to meet you. How can I help you today?"
                    ],
                    math: [
                        "I can help with mathematics! Please provide the specific problem or equation you'd like help with.",
                        "Great! I'm ready to solve mathematical problems. What would you like to work on?",
                        "Mathematics is one of my strengths. Feel free to ask any math-related questions!"
                    ],
                    emotional: [
                        "Thank you for sharing that with me. It sounds like you're going through something. Would you like to talk about it more?",
                        "I appreciate you opening up. Your feelings are valid and important. I'm here to listen.",
                        "It's okay to feel this way. Would you like to explore what's causing these feelings?"
                    ],
                    support: [
                        "Please know that you're not alone in this. Would you like to discuss what's troubling you?",
                        "I care about your wellbeing. Would it help to talk about what you're experiencing?",
                        "Your mental health is important. Let's work through this together."
                    ]
                };

                if (emotion.score >= 2) {
                    this.checkSafetyStatus(userMessage, emotion);
                    return responses.support[Math.floor(Math.random() * responses.support.length)];
                }

                if (userMessage.match(/hello|hi|hey|greet/i)) {
                    return responses.greeting[Math.floor(Math.random() * responses.greeting.length)];
                }

                if (userMessage.match(/math|equation|solve|calculate|integral|derivative|algebra/i)) {
                    return responses.math[Math.floor(Math.random() * responses.math.length)];
                }

                if (emotion.score > 0) {
                    return responses.emotional[Math.floor(Math.random() * responses.emotional.length)];
                }

                const defaultResponses = [
                    "That's an interesting point. Tell me more about that.",
                    "I understand. How does that make you feel?",
                    "Thank you for sharing. What would you like to explore further?",
                    "I see. Can you elaborate on that?",
                    "That's valuable information. What else is on your mind?"
                ];

                return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
            }

            checkSafetyStatus(message, emotion) {
                const distressKeywords = this.mentalhealthKeywords.distressed;
                const isDistressed = distressKeywords.some(k => message.toLowerCase().includes(k));

                const safetyWarning = document.getElementById('safetyWarning');
                if (isDistressed || emotion.score >= 3) {
                    safetyWarning.style.display = 'block';
                    this.addSystemMessage('‚ö†Ô∏è **Important:** If you\'re in crisis or having thoughts of self-harm, please contact emergency services (911 in US) or a crisis helpline immediately. Your safety is paramount.');
                } else {
                    safetyWarning.style.display = 'none';
                }
            }

            updateEmotionDisplay(emotion) {
                const label = document.getElementById('emotionLabel');
                const fill = document.querySelector('.emotion-fill');
                const indicator = document.querySelector('.emotion-indicator');

                label.textContent = emotion.type.charAt(0).toUpperCase() + emotion.type.slice(1);
                fill.style.width = (emotion.intensity * 100) + '%';

                indicator.textContent = emotion.emoji;
                indicator.className = `emotion-indicator emotion-${emotion.type}`;
            }

            sendMessage() {
                const input = document.getElementById('messageInput');
                const message = input.value.trim();

                if (!message) return;

                // Add user message
                this.addMessage(message, 'user');
                input.value = '';

                // Update stats
                this.sessionStats.messageCount++;
                this.userProfile.conversationCount++;
                this.saveUserProfile();

                // Simulate AI thinking
                const loadingElement = this.addMessage('', 'ai');
                loadingElement.innerHTML = '<div class="loading-indicator"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>';

                // Generate response
                setTimeout(() => {
                    const response = this.generateResponse(message);
                    loadingElement.textContent = response;
                    this.conversationContext.push({
                        user: message,
                        ai: response,
                        timestamp: new Date()
                    });
                }, 800);

                this.updateMemoryDisplay();
                this.updateSessionStats();
            }

            addMessage(content, type) {
                const container = document.getElementById('messagesContainer');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;

                const time = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

                if (type === 'user') {
                    messageDiv.innerHTML = `
                        <div>
                            <div class="message-bubble">${this.escapeHtml(content)}</div>
                            <div class="message-time">${time}</div>
                        </div>
                        <div class="message-avatar">üë§</div>
                    `;
                } else {
                    messageDiv.innerHTML = `
                        <div class="message-avatar">‚ö°</div>
                        <div>
                            <div class="message-bubble" id="aiMessage"></div>
                            <div class="message-time">${time}</div>
                        </div>
                    `;
                }

                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;

                return messageDiv.querySelector('.message-bubble');
            }

            addSystemMessage(content) {
                const container = document.getElementById('messagesContainer');
                if (container.innerHTML.includes('Welcome to Storm')) {
                    container.innerHTML = '';
                }

                const messageDiv = document.createElement('div');
                messageDiv.className = 'message ai';

                messageDiv.innerHTML = `
                    <div class="message-avatar">‚ö°</div>
                    <div>
                        <div class="message-bubble" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">${content}</div>
                        <div class="message-time">${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</div>
                    </div>
                `;

                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
            }

            updateMemoryDisplay() {
                document.getElementById('memoryName').textContent = this.userProfile.name;
                document.getElementById('memoryMood').textContent = this.userProfile.mood;
                document.getElementById('memoryCounts').textContent = this.userProfile.conversationCount;
                document.getElementById('statMessages').textContent = this.sessionStats.messageCount;

                const avgEmotion = this.sessionStats.emotionHistory.length > 0
                    ? (this.sessionStats.emotionHistory.reduce((a, b) => a + b.score, 0) / this.sessionStats.emotionHistory.length).toFixed(1)
                    : 0;

                const sentiments = ['Very Positive', 'Positive', 'Neutral', 'Concerned'][Math.floor(avgEmotion)] || 'Unknown';
                document.getElementById('statSentiment').textContent = sentiments;
            }

            updateSessionStats() {
                const startTime = this.sessionStats.startTime;
                const elapsed = Math.floor((Date.now() - startTime) / 60000);
                document.getElementById('statTime').textContent = elapsed + 'm';

                // Update emotion history visualization
                const historyContainer = document.getElementById('emotionHistory');
                if (this.sessionStats.emotionHistory.length > 0) {
                    historyContainer.innerHTML = this.sessionStats.emotionHistory.slice(-10).map(e => {
                        let color = '#a78bfa';
                        if (e.type === 'happy') color = '#d4fc79';
                        else if (e.type === 'concerned') color = '#fbbf24';
                        else if (e.type === 'distressed') color = '#f87171';
                        return `<div class="emotion-point" style="background: ${color};"></div>`;
                    }).join('');
                }

                setTimeout(() => this.updateSessionStats(), 60000);
            }

            showEmotionTracking() {
                const history = this.sessionStats.emotionHistory;
                if (history.length === 0) {
                    this.addSystemMessage('üìä No emotion data yet. Share your feelings as we chat, and I\'ll track your emotional patterns!');
                    return;
                }

                let report = 'üìä **Emotion Tracking Report:**\n\n';
                const emotions = {};
                history.forEach(e => {
                    emotions[e.type] = (emotions[e.type] || 0) + 1;
                });

                for (const [emotion, count] of Object.entries(emotions)) {
                    report += `${emotion.charAt(0).toUpperCase() + emotion.slice(1)}: ${count} instances\n`;
                }

                report += '\n*This helps me understand your emotional journey and provide better support.*';
                this.addSystemMessage(report);
            }

            initializeVoiceInput() {
                const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = 'en-US';
                recognition.continuous = false;

                recognition.onstart = () => {
                    document.getElementById('voiceBtn').classList.add('active');
                    document.getElementById('voiceBtn').textContent = 'üé§ Listening...';
                };

                recognition.onresult = (event) => {
                    let transcript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        transcript += event.results[i][0].transcript;
                    }
                    document.getElementById('messageInput').value = transcript;
                    document.getElementById('voiceBtn').classList.remove('active');
                    document.getElementById('voiceBtn').textContent = 'üé§ Voice';
                };

                recognition.onerror = () => {
                    document.getElementById('voiceBtn').classList.remove('active');
                    document.getElementById('voiceBtn').textContent = 'üé§ Voice';
                };

                recognition.start();
            }

            clearMemory() {
                if (confirm('Are you sure you want to clear all memories? This cannot be undone.')) {
                    localStorage.removeItem('stormUserProfile');
                    this.userProfile = {
                        name: 'User',
                        mood: 'Unknown',
                        conversationCount: 0,
                        preferences: { enableMath: false, enableVoice: false, theme: 'light' }
                    };
                    this.sessionStats.messageCount = 0;
                    this.sessionStats.emotionHistory = [];
                    this.conversationContext = [];
                    this.updateMemoryDisplay();
                    this.addSystemMessage('‚ú® Memory cleared! We can start fresh. How are you feeling today?');
                }
            }

            escapeHtml(text) {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return text.replace(/[&<>"']/g, m => map[m]);
            }
        }

        // Initialize Storm AI when page loads
        window.addEventListener('load', () => {
            window.stormAI = new StormAI();
        });

        // Auto-resize textarea
        const textarea = document.getElementById('messageInput');
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 100) + 'px';
        });
    </script>
</body>
</html>